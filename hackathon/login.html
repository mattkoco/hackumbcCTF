<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sign in — True Grit Vinyl</title>
  <style>
    :root{--gold:#ffcc00;--bg:#f4f3ee;--muted:#6b7280}
    html,body{margin:0;background:var(--bg);font:16px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;color:#111}
    .wrap{min-height:100vh;display:grid;place-items:center;padding:1rem}
    .card{width:min(440px,92vw);background:#fff;border:1px solid #e5e7eb;border-radius:16px;box-shadow:0 12px 30px rgba(0,0,0,.08);overflow:hidden}
    .hd{display:flex;align-items:center;gap:.6rem;padding:1rem;border-bottom:1px solid #eee}
    .logo{width:30px;height:30px;border-radius:8px;background:conic-gradient(from 30deg,var(--gold),#ffd84a,var(--gold))}
    form{padding:1rem;display:grid;gap:.85rem}
    label{font-weight:700;font-size:.9rem}
    input{width:100%;padding:.6rem .7rem;border:1px solid #e5e7eb;border-radius:10px;background:#fafafa}
    input:focus{outline:none;box-shadow:0 0 0 3px rgba(255,204,0,.35)}
    .row{display:flex;align-items:center;justify-content:space-between}
    .btn{border:1px solid #e5e7eb;background:var(--gold);border-radius:10px;padding:.6rem .9rem;font-weight:700;cursor:pointer}
    .muted{color:var(--muted);font-size:.9rem}
    .err{display:none;background:#fee2e2;color:#7f1d1d;border:1px solid #fecaca;border-radius:10px;padding:.6rem .75rem}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="hd"><div class="logo"></div><strong>Sign in</strong></div>
      <form id="form" autocomplete="on">
        <div id="err" class="err"></div>
        <div>
          <label for="username">Username</label>
          <input id="username" name="username" type="text" required autofocus autocomplete="username" />
        </div>
        <div>
          <label for="password">Password</label>
          <input id="password" name="password" type="password" required autocomplete="current-password" />
        </div>
        <div class="row">
          <a href="/index" class="muted">← Back</a>
          <button class="btn" type="submit">Sign in</button>
        </div>
      </form>
    </div>
  </div>
  <script>
    const form = document.getElementById('form');
    const err = document.getElementById('err');

    form.addEventListener('submit', async (e)=>{
      e.preventDefault();
      err.style.display='none'; err.textContent='';

      const payload = {
        username: form.username.value.trim(),
        password: form.password.value
      };

      try{
        const res = await fetch('/api/login', {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          credentials:'include',
          body: JSON.stringify(payload)
        });
        const data = await res.json();
        if(!res.ok || !data.ok){
          err.textContent = data.error || 'Sign-in failed.';
          err.style.display = 'block';
          return;
        }
        if(data.is_admin){
          localStorage.setItem('tg_isAdmin','true');  // optional UI toggle for your navbar
          window.location.href = '/admin';
        } else {
          localStorage.removeItem('tg_isAdmin');
          window.location.href = '/index';
        }
      }catch(ex){
        err.textContent = 'Network error.';
        err.style.display = 'block';
      }
    });
  </script>
</body>
</html>
